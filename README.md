# ğŸ›¡ï¸ PushGuardian

> **LangGraph ê¸°ë°˜ Git Pre-Push ë³´ì•ˆ & ì ì ˆí•œ í•™ìŠµ ì˜ˆì œ ì‹œìŠ¤í…œ**

## ê¸°íš ëª©ì  ë° ì½”ë”© ê³¼ì •
gitì„ ì‚¬ìš©í•˜ë©´ì„œ íŒ€ í˜‘ì—…ì„ í•˜ë‹¤ ë³´ë©´ ì»¤ì„œë‚˜ í´ë¡œë“œ ì½”ë“œë¥¼ í†µí•´ api keyë‚˜ id/pwê°€ ë“¤ì–´ê°„ ì½”ë”©ì„ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ì‹œ í•´ë‹¹ ì»¤ë°‹ë“¤ì„ ì§€ì›Œì•¼ í•©ë‹ˆë‹¤.
ë˜í•œ ê°ìê°€ ë°°ìš´ ê¸°ìˆ ì´ ë‹¬ë¼ ëˆ„êµ°ê°€ëŠ” íŠ¹ì • ê¸°ìˆ ìŠ¤íƒì˜ í•™ìŠµì— ëŒ€í•´ ì•½í•œ ë¶€ë¶„ì´ ìˆëŠ”ë° ê°œë°œì— ê¸‰ê¸‰í•´ ê·¼ë³¸ì ì¸ í•™ìŠµì„ ì„œë¡œ ì‹œì¼œì¤„ ì‹œê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.
í•´ë‹¹ ë¶€ë¶„ì— ëŒ€í•˜ì—¬ ìƒê°í•˜ê²Œ ë˜ë©´ì„œ ë³¸ ì‹œìŠ¤í…œì„ ì‘ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ì‘ì„±ê³¼ì •ì€ í’€ìŠ¤íƒìª½ì—ì„œ ì£¼ë¡œ js ë° ìë°”ë¥¼ ë°°ì› ë˜í„°ë¼ ai ê³¼ì •ì¤‘ì—ë‚˜ ì§€ê¸ˆë„ íŒŒì´ì¬ì„ ê³µë¶€í•˜ë©´ì„œ ì§œê³  ìˆê³  ì•„ì§ì€ í´ë¡œë“œ ì½”ë“œë¥¼ ì´ìš©í•œ ë¹„ì¤‘ì´ ë†’ì•„ì„œ ë” ì´í•´í•˜ë©´ì„œ ì§œë ¤ê³  í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## ê¸°ëŠ¥ ê°œìš”
PushGuardianì€ ì›ê²© ì €ì¥ì†Œì— pushí•˜ê¸° ì „ì— ë³´ì•ˆ ìœ„í—˜, ì¸ì¦ ì •ë³´ ìœ ì¶œ, ì•„í‚¤í…ì²˜ ìœ„ë°˜ì„ ìë™ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤. 
ë˜í•œ ë‹¨ìˆœíˆ ë§‰ê¸°ë§Œ í•˜ê±°ë‚˜ ìœ„í—˜ì„± ê²½ê³ ë¥¼ ë„˜ì–´ì„œì„œ, ì—ì´ì „íŠ¸ê°€ ì ì ˆì„±ì„ í‰ê°€í•œ ì¸í„°ë„· ë¬¸ì„œ ë§í¬ë¥¼ ì°¸ê³ í•˜ì—¬ ê·¼ë³¸ì ìœ¼ë¡œ ê³µë¶€í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•˜ëŠ” LangGraphë¥¼ ì‚¬ìš©í•œ ë¶„ì„ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### ë¡œì»¬ Git Hook ë³´í˜¸ ë° í•™ìŠµ
- âš¡ **í•˜ë“œ ì°¨ë‹¨ ê·œì¹™**: API í‚¤, ê°œì¸í‚¤, `.env` íŒŒì¼ ë“±ì´ í¬í•¨ëœ ì»¤ë°‹ì„ ì¦‰ì‹œ ì°¨ë‹¨
- ğŸ§  **ì†Œí”„íŠ¸ LLM ê²€ì‚¬(gpt-4-o-mini)**: ìœ„ í•˜ë“œ ë£° í†µê³¼ì‹œ AI ê¸°ë°˜ soft llm ì²´í¬. DTO/Schema ìœ„ë°˜, ì˜ì¡´ì„± ìœ„í—˜, ê¶Œí•œ ë³€ê²½ ê°ì§€ ë“± íŒë‹¨í•˜ì—¬ findingì— ë°˜ì˜(ë³´ì•ˆ / ì•„í‚¤í…ì²˜ ì™¸ ë¶€ì ì ˆí•œ ì˜ì¡´ì„±ë“±ì„ ìœ ì—°ì„±ìˆê²Œ ì²´í¬)
- ğŸ” **ì—ì´ì „íŠ¸ í˜• ReAct ë¦¬ì„œì¹˜ ë£¨í”„(gpt-4-o-mini)**: ì›ë¦¬ + ì˜ˆì œ ë§í¬ ìë™ ìˆ˜ì§‘.Tavily â†’ Serperìˆœ ìµœëŒ€ 2íšŒ í´ë°±í•˜ë©°, ìš°ì„  tavily ê²€ìƒ‰í›„ í•´ë‹¹ llm ì—ì´ì „íŠ¸ê°€ ê° ìë£Œì˜ ì ì ˆì„±ê³¼ ì¶©ë¶„ì„±ì„ ê´€ì°° í›„ serperë¥¼ ì‚¬ìš©í• ì§€ íŒë‹¨í•˜ì—¬ ê³„íšì„ ì„¸ìš°ê³  serper toolì„ ì´ìš©í•˜ì—¬ ê²€ìƒ‰í•˜ì—¬ ìë£Œ ë³´ì¶© ì‹¤í–‰
- ğŸ“ **ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸**: ì €ì¥ì†Œ ì™¸ë¶€ì— ì €ì¥ (`git reset`ì—ë„ ë³´ì¡´ë¨)
- ğŸ¤ **Human-in-Loop**: ì‚¬ìœ  ê¸°ë¡ê³¼ í•¨ê»˜ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥(ë¡œì»¬ ì‚¬ìš©ì‹œ ê°•ì œ í‘¸ì‹œ(uiê°œë°œì¤‘))
- ğŸ“ **ì·¨ì•½ ìŠ¤íƒ í•™ìŠµ**: ë³´ì•ˆ ì‚¬ìœ ê°€ ìš°ì„ ë˜ì§€ë§Œ, .pushguardianì•ˆì˜ ì´ˆê¸° config.yaml ì„¤ì •ì„ í†µí•´ ì·¨ì•½ ìŠ¤íƒì„ ì •í•´ë‘ë©´ í•´ë‹¹ ê¸°ìˆ ì´ git diffë¡œ íƒì§€ì‹œ ê·¸ì— ë§ëŠ” í•™ìŠµ ê·¼ë³¸ì›ë¦¬ì™€ ì˜ˆì œë¥¼ ì°¾ì•„ ì¤ë‹ˆë‹¤. 

### ì›¹ ë°ëª¨(ì‹¤ì œ pre-push hookê³¼ commit ì œì™¸: í•´ë‹¹ git diffì— ëŒ€í•œ ê²€ìƒ‰ ì—ì´ì „íŠ¸ ë¶€ë¶„ êµ¬í˜„)

- ğŸš€ **ë°°í¬ í†µë¡œ**: Streamlit Cloud
- âš¡ **ë¡œì»¬ ê¹ƒ í›… ë³´í˜¸ ë­ê·¸ë˜í”„ êµ¬í˜„**: ì‹¤ì œ ë¡œì»¬ì—ì„œì˜ ì´ˆê¸° ì¼ë¶€ ë‹¨ê³„ ì œì™¸í•˜ê³  ë­ê·¸ë˜í”„ ì‹¤í–‰
- ğŸŒ **Streamlit ì¸í„°í˜ì´ìŠ¤**: git diff ì—…ë¡œë“œ ë˜ëŠ” í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸°
- ğŸ“¥ **ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ**: ë°œê²¬ì‚¬í•­ + í•™ìŠµ ë§í¬ê°€ í¬í•¨ëœ ë§ˆí¬ë‹¤ìš´ íŒŒì¼

## ğŸš€ ë¡œì»¬ì—ì„œì˜ ì‚¬ìš©ë²•

### 1. í™˜ê²½ ì„¤ì •

### Conda í™˜ê²½ ìƒì„±
conda create -n p_guard python=3.10 -y
conda activate p_guard
pip install -r requirements.txt

### íŒ¨í‚¤ì§€ë¥¼ í¸ì§‘ ê°€ëŠ¥ ëª¨ë“œë¡œ ì„¤ì¹˜
pip install -e .

### 2. .envì— API í‚¤ ì„¤ì • (openAI, tavily, serper, langsmith)

### 3. Git Hook ì„¤ì¹˜

### ì‚¬ìš©í•˜ë ¤ëŠ” ëŒ€ìƒ git ì €ì¥ì†Œì—ì„œ ì‹¤í–‰
ë ˆí¬ì§€í† ë¦¬ì™€ ì—°ê²°ë˜ì–´ git init ëœ í´ë” ì˜ˆì‹œ
-> cd /path/to/your/project
conda activate p_guard
python -m pushguardian.install_hook
ì´ ëª…ë ¹ì€ `pre-push` hookì„ ì„¤ì¹˜í•˜ì—¬ í•´ë‹¹ ë ˆí¬ì˜ ëª¨ë“  `git push` ì „ì— PushGuardianì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
ê°ì¢… ìœ„ë°˜ì‚¬í•­ í¬í•¨ commit í›„ í„°ë¯¸ë„ì—ì„œ  git push -u origin main ì‹œ 
block ê´€ë ¨ ë¡œê·¸ ë°œìƒí•˜ë©° blockì´ ì§„í–‰ë©ë‹ˆë‹¤.

## ğŸŒ ë¡œì»¬ ì›¹ ë°ëª¨ ì‹¤í–‰(í´ë¼ìš°ë“œ ì„¤ì •ì‹œ ì›¹ìƒìœ¼ë¡œ ì£¼ì†Œ ë°°í¬ ê°€ëŠ¥)

**Streamlitë¡œ web êµ¬ë™**
streamlit run streamlit_app.py (web uiì™€ python run guardian ì‹¤í–‰)

## ğŸ“ í”„ë¡œì íŠ¸ ì£¼ìš” êµ¬ì¡°
```
pushguardian/
â”œâ”€â”€ pushguardian/
â”‚   â”œâ”€â”€ config.py           # YAML + API í‚¤ ë¡œë”
â”‚   â”œâ”€â”€ git_ops.py          # Git diff ì¶”ì¶œ
â”‚   â”œâ”€â”€ detectors/          # í•˜ë“œ ê·œì¹™ ê°ì§€ê¸°
â”‚   â”‚   â”œâ”€â”€ secrets.py      # ë¹„ë°€ ì •ë³´ íƒì§€
â”‚   â”‚   â”œâ”€â”€ files.py        # ë¯¼ê° íŒŒì¼ íƒì§€
â”‚   â”‚   â””â”€â”€ stack_guess.py  # ìŠ¤íƒ ì¶”ë¡ 
â”‚   â”œâ”€â”€ llm/                # LLM ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ judge.py        # ì†Œí”„íŠ¸ ì²´í¬ íŒì •
â”‚   â”‚   â”œâ”€â”€ observe.py      # ì¦ê±° ê²€ì¦
â”‚   â”‚   â””â”€â”€ research_planner.py  # ë¦¬ì„œì¹˜ ê³„íš
â”‚   â”œâ”€â”€ research/           # ì›¹ ê²€ìƒ‰
â”‚   â”‚   â”œâ”€â”€ tavily_client.py
â”‚   â”‚   â”œâ”€â”€ serper_client.py
â”‚   â”‚   â””â”€â”€ gather.py       # ë¦¬ì„œì¹˜ ìˆ˜ì§‘
â”‚   â”œâ”€â”€ report/             # ë¦¬í¬íŠ¸ ìƒì„±
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â””â”€â”€ writer.py
â”‚   â”œâ”€â”€ graph.py            # LangGraph ì›Œí¬í”Œë¡œìš°â­
â”‚   â”œâ”€â”€ cli.py              # Pre-push CLI
â”‚   â”œâ”€â”€ install_hook.py     # Hook ì„¤ì¹˜ ë„êµ¬
â”‚   â””â”€â”€ web.py              # FastAPI ì„œë²„ (ì´ˆê¸° ì½”ë”©)
â”œâ”€â”€ .pushguardian/
â”‚   â””â”€â”€ config.yaml         # ì‚¬ìš©ì ì„¤ì •â­(ë°°ìš´ ìŠ¤íƒ, ì•½í•œ ìŠ¤íƒ ì„¤ì • ê°€ëŠ¥)
â”‚                             
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ test_file/          # í…ŒìŠ¤íŠ¸ diff íŒŒì¼ ì˜ˆì œë“¤
â”‚      
â”œâ”€â”€ tests/                  # ì „ì²´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ
â””â”€â”€ streamlit_app.py        # Streamlit í”„ë¡ íŠ¸ì—”ë“œ
```

## ğŸ§ª í…ŒìŠ¤íŠ¸
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:
pytest tests/ -v

## ğŸ§ª ë””ë²„ê¹…
UIë¥¼ í†µí•´ ê²€ìƒ‰ queryë¬¸, iteration, langsmithë¡œ trace í™•ì¸ ë° ê³µë¶€

## ğŸ“Š LangGraph ì›Œí¬í”Œë¡œìš°

```
load_config â†’ scope_classify â†’ hard_policy_check â†’ soft_llm_judge
                                                          â†“
                                            [ë¦¬ì„œì¹˜ í•„ìš”?]
                                                          â†“
                                                   research_tavily
                                                          â†“
                                               observation_validate(llm ì—ì´ì „íŠ¸ ReAct)
                                                          â†“
                                              [ì¶©ë¶„? or ì¬ê²€ìƒ‰?(ìµœëŒ€ 2íšŒ loop/ planí›„ search)]
                                                    â†™         â†˜
                                          write_report    research_serper
                                                â†“
                                          persist_report â†’ END
```

### ì£¼ìš” ë…¸ë“œ ì„¤ëª…

1. **load_config**: ì„¤ì • íŒŒì¼ ë¡œë“œ, ëª¨ë“  state ê¸°ë³¸ê°’ ì„¤ì •
2. **scope_classify**: íŒŒì¼ íƒ€ì… ë° ìŠ¤íƒ ë¶„ë¥˜
3. **hard_policy_check**: ë¹„ë°€ ì •ë³´ ë° ë¯¼ê° íŒŒì¼ ê²€ì‚¬ (ì¦‰ì‹œ ì°¨ë‹¨), íˆìŠ¤í† ë¦¬ ìŠ¤ìº”- ëª‡ ì»¤ë°‹ ì „ì— ì¶”ê°€ë˜ì—ˆëŠ”ì§€
4. **soft_llm_judge**: LLM ê¸°ë°˜ ë³´ì•ˆ ë¶„ì„ + í•™ìŠµ í¬ì¸íŠ¸ ì¶”ì¶œ(GPT-4o-mini)
5. **research_tavily/serper(GPT-4o-mini)**: ë³´ì•ˆ ì›ë¦¬ ë° í•™ìŠµ ìë£Œ ê²€ìƒ‰
	- 1ì°¨ tavily : Findings â†’ ë³´ì•ˆ ì›ë¦¬ ê²€ìƒ‰, Weak stacks â†’ í•™ìŠµ ìë£Œ ê²€ìƒ‰
	- 2ì°¨ serper : observation_validate`ì—ì„œ "ë¶ˆì¶©ë¶„" íŒë‹¨ ì‹œ LLMì´ ìƒì„±í•œ refined queryë¡œ ì¬ê²€ìƒ‰
6. **observation_validate**: LLMì´ ê²€ìƒ‰ ê²°ê³¼ í’ˆì§ˆ í‰ê°€(GPT-4o-mini)
7. **write_report**: ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ ìƒì„±
8. **persist_report**: ë¦¬í¬íŠ¸ ì €ì¥

### ì£¼ìš” State ì„¤ëª…
 ì…ë ¥ (Input)
- `diff_text`: Git diff ì›ë¬¸
- `mode`: "cli" | "web" (ì‹¤í–‰ ëª¨ë“œ)
- `config`: ì„¤ì • íŒŒì¼ (.pushguardian/config.yaml)
 ë¶„ì„ ë°ì´í„°
- `changed_files`: ë³€ê²½ëœ íŒŒì¼ ëª©ë¡
- `detected_stacks`: ê°ì§€ëœ ê¸°ìˆ  ìŠ¤íƒ (docker, react ë“±)
- `weak_stack_touched`: ì•½í•œ ìŠ¤íƒ ëª©ë¡ (í•™ìŠµ ëª¨ë“œ)
 ë³´ì•ˆ ë¶„ì„ ê²°ê³¼
- `hard_findings`: í•˜ë“œ ì°¨ë‹¨ ì´ìŠˆ (secrets, .env)
- `soft_findings`: ì†Œí”„íŠ¸ ì´ìŠˆ (XSS, SQL injection)
- `risk_score`: ìœ„í—˜ ì ìˆ˜ (0.0~1.0)
- `severity`: "low" | "medium" | "high" | "critical"
- `decision`: "allow" | "block" | "override"
 ë¦¬ì„œì¹˜ & í•™ìŠµ
- `evidence`: ê²€ìƒ‰ ê²°ê³¼ (principle_links, example_links)
- `learning_points`: ê¸°ë³¸ ê°œë… í•™ìŠµ í¬ì¸íŠ¸ (weak stackìš©)
- `recheck_count`: ë¦¬ì„œì¹˜ ë°˜ë³µ íšŸìˆ˜ (0=Tavily, 1=Serper)
- `research_plan`: LLM í”Œë˜ë„ˆ ì¶œë ¥ (next_action, reasoning)
 ì¶œë ¥
- `history_hint`: íˆìŠ¤í† ë¦¬ ìŠ¤ìº” ê²°ê³¼ (ëª‡ ì»¤ë°‹ ì „?)
- `report_md`: ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸
- `report_path`: ì €ì¥ëœ ë¦¬í¬íŠ¸ íŒŒì¼ ê²½ë¡œ


### **LangGraph, Streamlitìœ¼ë¡œ ë§Œë“  ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸**
